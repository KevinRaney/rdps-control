---
##
## Hiera config for my VPS
##
classes:
  - role::vps
## Packages not installed by other modules
packages:
  - irssi
  - tmux
  - zsh
  - git
  - lynx
  - rsync
  - zip
  - 'vim-minimal'
sudo::sudoers:
  gitolite_r10k:
    ensure: present
    comment: "Let gitolite kick off r10k"
    users:
    - gitolite
    runas:
    - root
    cmnds:
    - /usr/local/bin/r10k
    tags:
    - NOPASSWD
ruby::ruby_dev_packages:
  - 'ruby-devel'
  - 'rubygem-bundler'
ruby::dev::ruby_dev_packages:
  - 'ruby-devel'
  - 'rubygem-bundler'

profile::mysql::root_password: ENC[PKCS7,MIIBiQYJKoZIhvcNAQcDoIIBejCCAXYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAer7xLfxrv4kCEyJjBQpejX8aW/AKj/F1i4CVgNNRN6uR+RNZw23nS8Pa16cXfSIul6+j6DJX6Jqhhc3CG/G7wQizEHnX7j/qEXTjZk9heccbpHaC2EE6IZQb4U/WICMmLGS3+j9bbINd5wIXcG4xafc9vYjwVFef/RamG5+GnLf/ivS/eRZ8ZtRfFWYeF+3/Qk0aHWYKFTNpdnmAt6S0j/wj4P36LDbDC1s2eVrzWp6yd5xb446hwcemWVyyh9QrzlgXxPRDnplVYahBNUR9/rEjy0KIB32J1piFGQwjj0QigZrM6J0ntb2GLIBg2RGjycTJj4WDMs7U2IicSs22tjBMBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBCt+lf0YMiif8j3QW6/+I3qgCDb7OGGA8dlFyIAZ1yLVDj6Lfh6vIOa/9PuRiSAM0+H0A==]

profile::piwik::mysql__password: ENC[PKCS7,MIIBiQYJKoZIhvcNAQcDoIIBejCCAXYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAswcknNr13eOtweg9CDn3BXTnjopVDOuv4gIpyAvBNg0RbHYCQp1EqR72FYMCssES9S66/CUyZEZOh0ZMn0ObckBM1zFMPvqHDlyataDBeA95CRMg4rjYX3tKjenQQe+YMMSM+PnQD/UfE68c1tukOTvx1perbySmm6I1i5tejqbqGx4MF75uJJGuUbLBvpsPMNv4VnTKV8NifgBob87JY7oLwxD7M21jONmK65i2bu4HeFDZl8Q7m2NXN57IiA586nvajiT/Nn4exAhuX3IW6i9Qu2jTAJek/nTpVXV0wCB2OQY+C524giewy1GZfnA0j6e+QIm+9A7Z3QcXeXJHCjBMBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBDygoFuuFp+6fjOxN2jfADKgCDtP3qVWiwN2RuNMyykDm7JwLqZdsBZSg9hqu+ju93usQ==]
##
## Nginx vhosts
##
nginx::nginx_vhosts:
  'mc.signalboxes.net':
    ensure: present
    server_name: ['mc.signalboxes.net']
    www_root: "/var/www/mc.signalboxes.net"
    access_log: '/var/log/nginx/mc.signalboxes.net.access.log'
    error_log: '/var/log/nginx/mc.signalboxes.net.error.log'
    use_default_location: false
#    include_files: ['global/restrictions.conf']
    vhost_cfg_prepend:
      'index': 'index.php index.html'
    vhost_cfg_append:
      'rewrite ^': "http://signalboxes.net/minecraft-server/ permanent"
  'joshbeard.me':
    ensure: present
    server_name: ['joshbeard.me', 'www.joshbeard.me']
    www_root: "/var/www/joshbeard.me"
    access_log: "/var/log/nginx/joshbeard.me_access.log"
    error_log: "/var/log/nginx/joshbeard.me_error.log"
    use_default_location: false
#    include_files: ['global/restrictions.conf']
    vhost_cfg_append:
      'rewrite ^': "http://signalboxes.net/about/"
  'hewbert.com':
    ensure: present
    server_name: ['hewbert.com', 'www.hewbert.com']
    www_root: "/var/www/hewbert.com"
    access_log: '/var/log/nginx/hewbert.com.access.log'
    error_log: '/var/log/nginx/hewbert.com.error.log'
    use_default_location: false
#    include_files: ['global/restrictions.conf']
    vhost_cfg_prepend:
      'index': 'index.html'
    vhost_cfg_append:
      'rewrite ^': "http://signalboxes.net/ permanent"
  'webmail.hewbert.com':
    use_default_location: false
    vhost_cfg_append:
      'rewrite ^': 'https://mail.google.com/a/hewbert.com permanent'
  'signalboxes.net':
    use_default_location: false
    listen_options: "default_server"
    server_name: ['signalboxes.net', 'www.signalboxes.net', 'www1.signalboxes.net', 'www2.signalboxes.net', 'www3.signalboxes.net', 'ipv6.signalboxes.net']
    www_root: '/var/www/signalboxes.net'
    index_files: ['index.html']
    access_log: '/var/log/nginx/signalboxes.net-access.log'
    error_log: '/var/log/nginx/signalboxes.net-error.log'
#    include_files: ['global/restrictions.conf']
    vhost_cfg_prepend:
      'index': 'index.html'
      'gzip_vary': 'on'
      'error_page': '404 = /404.html'
      'error_page': '403 = /403.html'
    gzip_types: 'text/plain application/javascript application/x-javascript text/xml text/css'
  'signaltotrust.net':
    ensure: present
    server_name: ['www.signaltotrust.net', 'signaltotrust.net']
    www_root: "/var/www/signaltotrust.net"
    access_log: '/var/log/nginx/signaltotrust.access.log'
    error_log: '/var/log/nginx/signaltotrust.error.log'
    use_default_location: false
#    include_files: ['global/restrictions.conf']
    vhost_cfg_prepend:
      'index': 'index.php'
    vhost_cfg_append:
      'rewrite ^': "http://signalboxes.net/ permanent"
nginx::nginx_locations:
  'image_cache':
    location: '~* \.(js|css|png|jpg|jpeg|gif|ico)$'
    vhost: 'signalboxes.net'
    location_custom_cfg:
      'expires': '60d'
## Disabled for now until ssl hosts support cfg_prepend or indexes
#    ssl: true
#    ssl_cert: '/etc/nginx/ssl/unified.crt'
#    ssl_key: '/etc/nginx/ssl/server.key'
#    ssl_ciphers: 'RC4:HIGH:!aNULL:!MD5'
